% Simulated S-shaped Controller for 2-Segment Robot 

clc;
clear all;

%% Set Parameters
global errort;
global errorr;
global t_prev;
global t_prev_list;
global t_list;

global m;
global l;
global r;
global r2;
global g;
global k;
global lambda;

global u_prev;
global vel_x_list;
global vel_y_list;
global actual_x_list;
global r_actual_list;
global r_target_list;
global t_actual_list;
global t_target_list;
global time_list;

global f1_list;
global f2_list;
global ff1_list;
global ff2_list;
global f1t_list;
global f2t_list;
global ff1t_list;
global ff2t_list;
global f1r_list;
global f2r_list;
global ff1r_list;
global ff2r_list; 

t_prev = 0;
t_prev_list = [];
t_list = [];

u_prev = zeros(18,1);
vel_x_list = [];
vel_y_list = [];
actual_x_list = [];

r_actual_list = [];
r_target_list = [];
t_actual_list = [];
t_target_list = [];
time_list = [];

f1_list = []; 
f2_list = []; 
ff1_list = [];
ff2_list = [];

f1t_list = []; 
f2t_list = []; 
ff1t_list = [];
ff2t_list = [];
    
f1r_list = []; 
f2r_list = []; 
ff1r_list = [];
ff2r_list= []; 

errorx = 0;
errory = 0;

m =0.1; %Pole Mass (kg)
l=0.045; %Pole Length (m)
r = 0.03; %Radius of disc (m)
r2 = 0.045;
g=9.81*0; %Gravity (m/s^2)
k = 1; %Spring constant (Nm/theta)
lambda = 1; %Damping constant (Nm/Omega)

%% Set Control Parameters
% PID Control Gains
global Kp1;
global Ki1;
global Kd1;
global Kp2;
global Ki2;
global Kd2;

% t
Kp1= 1.5*2; % P-gain 50
Ki1= 0.3*2*1; % I-gain 10
Kd1= 0.3*2*1; % D-gain 0

% r
Kp2= 100*2*1; % P-gain 5000
Ki2= 50*2*1; % I-gain 2000
Kd2= 50*2*0; % D-gain 0

%Real gains are twice the values
%% set desired angle
global x_target;
global y_target;
global r_target;
global t_target;

r_target = 0.72;
t_target = 0;


x_actual = @(u) -l*(2*sin(u(1))+2*sin(u(1)+u(3))+2*sin(u(1)+u(3)+u(5))+2*sin(u(1)+u(3)+u(5)+u(7))+2*sin(u(1)+u(3)+u(5)+u(7)+u(9))+2*sin(u(1)+u(3)+u(5)+u(7)+u(9)+u(11))+2*sin(u(1)+u(3)+u(5)+u(7)+u(9)+u(11)+u(13))+sin(u(1)+u(3)+u(5)+u(7)+u(9)+u(11)+u(13)+u(15))) ;
y_actual = @(u) l*(1+2*cos(u(1))+2*cos(u(1)+u(3))+2*cos(u(1)+u(3)+u(5))+2*cos(u(1)+u(3)+u(5)+u(7))+2*cos(u(1)+u(3)+u(5)+u(7)+u(9))+2*cos(u(1)+u(3)+u(5)+u(7)+u(9)+u(11))+2*cos(u(1)+u(3)+u(5)+u(7)+u(9)+u(11)+u(13))+cos(u(1)+u(3)+u(5)+u(7)+u(9)+u(11)+u(13)+u(15)) );

%%
global saved1; 
global saved2;
global saved3;
%% Run Simulation

f = figure(1);
slider_t = uicontrol('Parent',f,'Style','slider','Position',[81,400,419,23],...
          'value',t_target, 'min',-90, 'max',90,'Callback',@update_targett);
slider_r = uicontrol('Parent',f,'Style','slider','Position',[488,45,23,419],...
          'value',r_target, 'min',0.35, 'max',0.72,'Callback',@update_targetr);
axis([-0.7 0.7 -0.4 1.0])
xlabel('x-axis (m)')
ylabel('y-axis (m)')
box on
grid on
hold on
daspect([1 1 1])

u0 = zeros(18,1);
tspan = 0:0.01:15; %Simulation Time 0:dt:TMax

options= odeset('OutputFcn',@Animate_real_time_S_shaped_2segment);
[t,u] = ode15s(@odefunc,tspan,u0,options); %Compute Simulation


function dudt=odefunc (t,u)
    %% Set Parameters
    global errort;
    global errorr;
    global t_prev;
    global t_prev_list;
    global t_list;
    
    global x_target;
    global y_target;
    global t_target;
    global r_target;
    global m;
    global l;
    global r;
    global r2;
    global g;
    global k;
    global lambda;
    global Kp1;
    global Ki1;
    global Kd1;
    global Kp2;
    global Ki2;
    global Kd2;
    
    global u_prev;
    global vel_x_list;
    global vel_y_list;  
    global actual_x_list;

    global f1_list;
    global f2_list;
    global ff1_list;
    global ff2_list;
    
    global f1t_list;
    global f2t_list;
    global ff1t_list;
    global ff2t_list;
    
    global f1r_list;
    global f2r_list;
    global ff1r_list;
    global ff2r_list;  
    
    global approach;
    global saved1;
    global saved2;
    global saved3;
    
    r_target = 0.5;
    t_target = 25;    


    x_actual = @(u) -l*(2*sin(u(1))+2*sin(u(1)+u(3))+2*sin(u(1)+u(3)+u(5))+2*sin(u(1)+u(3)+u(5)+u(7))+2*sin(u(1)+u(3)+u(5)+u(7)+u(9))+2*sin(u(1)+u(3)+u(5)+u(7)+u(9)+u(11))+2*sin(u(1)+u(3)+u(5)+u(7)+u(9)+u(11)+u(13))+sin(u(1)+u(3)+u(5)+u(7)+u(9)+u(11)+u(13)+u(15))) ;      
    y_actual = @(u) l*(1+2*cos(u(1))+2*cos(u(1)+u(3))+2*cos(u(1)+u(3)+u(5))+2*cos(u(1)+u(3)+u(5)+u(7))+2*cos(u(1)+u(3)+u(5)+u(7)+u(9))+2*cos(u(1)+u(3)+u(5)+u(7)+u(9)+u(11))+2*cos(u(1)+u(3)+u(5)+u(7)+u(9)+u(11)+u(13))+cos(u(1)+u(3)+u(5)+u(7)+u(9)+u(11)+u(13)+u(15)) );
    %% Control
    r_actual = (x_actual(u)^2 + y_actual(u)^2)^(0.5);
    dot_r_actual = @(u) (u(2)*(2*l^2*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1))) - 2*l^2*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)))/(2*(l^2*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + l^2*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2)^(1/2)) - (u(12)*(2*l^2*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)))*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1) - 2*l^2*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)))*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))))/(2*(l^2*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + l^2*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2)^(1/2)) - (u(10)*(2*l^2*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)))*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1) - 2*l^2*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)))*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))))/(2*(l^2*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + l^2*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2)^(1/2)) - (u(14)*(2*l^2*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)))*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1) - 2*l^2*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)))*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))))/(2*(l^2*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + l^2*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2)^(1/2)) - (u(8)*(2*l^2*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)))*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1) - 2*l^2*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)))*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))))/(2*(l^2*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + l^2*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2)^(1/2)) - (u(6)*(2*l^2*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)))*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1) - 2*l^2*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)))*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))))/(2*(l^2*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + l^2*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2)^(1/2)) - (u(16)*(2*l^2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15))*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1) - 2*l^2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15))*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))))/(2*(l^2*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + l^2*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2)^(1/2)) - (u(4)*(2*l^2*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)))*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1) - 2*l^2*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)))*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))))/(2*(l^2*(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + l^2*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2)^(1/2));
    dot_t_actual = @(u) (180*u(6)*((2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)))/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1) + ((2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)))*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1))))/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2))/(pi*((2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + 1)) - (180*u(2)*((2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + (2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)))/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)))/(pi*((2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + 1)) - (180*u(16)*(cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15))/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1) + (sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15))*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1))))/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2))/(pi*((2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + 1)) - (180*u(4)*((2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)))/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1) + ((2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)))*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1))))/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2))/(pi*((2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + 1)) - (180*u(12)*((2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)))/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1) + ((2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)))*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1))))/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2))/(pi*((2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + 1)) - (180*u(10)*((2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)))/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1) + ((2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)))*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1))))/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2))/(pi*((2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + 1)) - (180*u(14)*((2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)))/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1) + ((2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)))*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1))))/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2))/(pi*((2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + 1)) - (180*u(8)*((2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)))/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1) + ((2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)))*(2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1))))/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2))/(pi*((2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*sin(u(1) + u(3) + u(5)) + sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*sin(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*sin(u(1) + u(3) + u(5) + u(7)) + 2*sin(u(1) + u(3)) + 2*sin(u(1)))^2/(2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9)) + 2*cos(u(1) + u(3) + u(5)) + cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(1) + u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(1) + u(3) + u(5) + u(7)) + 2*cos(u(1) + u(3)) + 2*cos(u(1)) + 1)^2 + 1));

    
    t_actual = atan(-x_actual(u)/y_actual(u))*180/pi;
    errort = u(17);
    errorr = u(18);
    
    t_prev_list(end+1) = t-t_prev;
    t_prev = t; 
    t_list(end+1)= t_prev;
    
    f1 = 0; %Left long tendon force
    f2 = 0; %Right long tendon force
    ff1 = 0; %Left short tendon force
    ff2 = 0; %Right short tendon force
    

    actual_x_list(end+1) = x_actual(u);
    

    yt = (t_target-t_actual)*Kp1 + errort*Ki1 + dot_t_actual(u)*Kd1
    yr = (r_target-r_actual)*Kp2 + errorr*Ki2 + dot_r_actual(u)*Kd2
    f1t = yt;
    ff1t = yt;
    f2t = -yt; 
    ff2t = -yt;

        
    if (t_target <= 0)
        f1r = -yr;
        ff1r = yr;
        f2r = yr;
        ff2r = -yr;
    else
        f1r = yr;
        ff1r = -yr;
        f2r = -yr;
        ff2r = yr;
    end


    threshold = 10000;
    min_thres = 0;
    f1 = min(max(0.5*(f1t + f1r), min_thres), threshold);
    f2 = min(max(0.5*(f2t + f2r), min_thres), threshold);

    ff1 = min(max(0.5*(ff1t + ff1r), min_thres), threshold);
    ff2 = min(max(0.5*(ff2t + ff2r), min_thres), threshold);

    %% Non-Linear Dynamics


    G = @(u)[k*u(1);
     k*u(3);
     k*u(5);
     k*u(7);
     k*u(9);
     k*u(11);
     k*u(13);
     k*u(15)];


    %% Q with obstacle

    
    f3 = 0; %Obstacle or external force
    Q = @(u) [r*(f1*(cos(u(1)/2) - cos(u(3)/2)) - f2*(cos(u(1)/2) - cos(u(3)/2))) + r*(f1*(cos(u(3)/2) - cos(u(5)/2)) - f2*(cos(u(3)/2) - cos(u(5)/2))) + r*(f1*(cos(u(5)/2) - cos(u(7)/2)) - f2*(cos(u(5)/2) - cos(u(7)/2))) + r*(f1*(cos(u(7)/2) - cos(u(9)/2)) - f2*(cos(u(7)/2) - cos(u(9)/2))) + r*(f1*(cos(u(9)/2) - cos(u(11)/2)) - f2*(cos(u(9)/2) - cos(u(11)/2))) + r*(f1*(cos(u(11)/2) - cos(u(13)/2)) - f2*(cos(u(11)/2) - cos(u(13)/2))) + r*(f1*(cos(u(13)/2) - cos(u(15)/2)) - f2*(cos(u(13)/2) - cos(u(15)/2))) + r2*(ff1*(cos(u(1)/2) - cos(u(3)/2)) - ff2*(cos(u(1)/2) - cos(u(3)/2))) + r2*(ff1*(cos(u(3)/2) - cos(u(5)/2)) - ff2*(cos(u(3)/2) - cos(u(5)/2))) + r2*(ff1*(cos(u(5)/2) - cos(u(7)/2)) - ff2*(cos(u(5)/2) - cos(u(7)/2))) + r*(f1*cos(u(15)/2) - f2*cos(u(15)/2)) + r2*(ff1*cos(u(7)/2) - ff2*cos(u(7)/2)) + l*(f1*(sin(u(1)/2) + sin(u(3)/2)) + f2*(sin(u(1)/2) + sin(u(3)/2))) + l*(ff1*(sin(u(1)/2) + sin(u(3)/2)) + ff2*(sin(u(1)/2) + sin(u(3)/2))) - l*(2*f1*(cos(u(11)/2) - cos(u(13)/2)) + 2*f2*(cos(u(11)/2) - cos(u(13)/2)))*(sin(u(3) + u(5) + u(7) + u(9) + u(11)) + sin(u(7) + u(9) + u(11)) + sin(u(5) + u(7) + u(9) + u(11)) + sin(u(9) + u(11)) + sin(u(11))) + l*(f1*(sin(u(11)/2) + sin(u(13)/2)) + f2*(sin(u(11)/2) + sin(u(13)/2)))*(2*cos(u(3) + u(5) + u(7) + u(9) + u(11)) + 2*cos(u(7) + u(9) + u(11)) + 2*cos(u(5) + u(7) + u(9) + u(11)) + 2*cos(u(9) + u(11)) + 2*cos(u(11)) + 1) - l*(sin(u(3) + u(5)) + sin(u(5)))*(2*f1*(cos(u(5)/2) - cos(u(7)/2)) + 2*f2*(cos(u(5)/2) - cos(u(7)/2))) - l*(sin(u(3) + u(5)) + sin(u(5)))*(2*ff1*(cos(u(5)/2) - cos(u(7)/2)) + 2*ff2*(cos(u(5)/2) - cos(u(7)/2))) + l*(2*cos(u(3)) + 1)*(f1*(sin(u(3)/2) + sin(u(5)/2)) + f2*(sin(u(3)/2) + sin(u(5)/2))) + l*(2*cos(u(3)) + 1)*(ff1*(sin(u(3)/2) + sin(u(5)/2)) + ff2*(sin(u(3)/2) + sin(u(5)/2))) + l*(ff1*sin(u(7)/2) - f3 + ff2*sin(u(7)/2))*(2*cos(u(3) + u(5) + u(7)) + 2*cos(u(5) + u(7)) + 2*cos(u(7)) + 1) + l*(f1*(sin(u(5)/2) + sin(u(7)/2)) + f2*(sin(u(5)/2) + sin(u(7)/2)))*(2*cos(u(3) + u(5)) + 2*cos(u(5)) + 1) + l*(ff1*(sin(u(5)/2) + sin(u(7)/2)) + ff2*(sin(u(5)/2) + sin(u(7)/2)))*(2*cos(u(3) + u(5)) + 2*cos(u(5)) + 1) - l*(2*f1*(cos(u(7)/2) - cos(u(9)/2)) + 2*f2*(cos(u(7)/2) - cos(u(9)/2)))*(sin(u(3) + u(5) + u(7)) + sin(u(5) + u(7)) + sin(u(7))) - l*(2*ff1*cos(u(7)/2) + 2*ff2*cos(u(7)/2))*(sin(u(3) + u(5) + u(7)) + sin(u(5) + u(7)) + sin(u(7))) - l*(2*f1*(cos(u(13)/2) - cos(u(15)/2)) + 2*f2*(cos(u(13)/2) - cos(u(15)/2)))*(sin(u(5) + u(7) + u(9) + u(11) + u(13)) + sin(u(9) + u(11) + u(13)) + sin(u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + sin(u(7) + u(9) + u(11) + u(13)) + sin(u(11) + u(13)) + sin(u(13))) - l*(2*f1*cos(u(15)/2) + 2*f2*cos(u(15)/2))*(sin(u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + sin(u(7) + u(9) + u(11) + u(13) + u(15)) + sin(u(11) + u(13) + u(15)) + sin(u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + sin(u(9) + u(11) + u(13) + u(15)) + sin(u(13) + u(15)) + sin(u(15))) + l*(f1*(sin(u(9)/2) + sin(u(11)/2)) + f2*(sin(u(9)/2) + sin(u(11)/2)))*(2*cos(u(5) + u(7) + u(9)) + 2*cos(u(3) + u(5) + u(7) + u(9)) + 2*cos(u(7) + u(9)) + 2*cos(u(9)) + 1) + l*(f1*(sin(u(7)/2) + sin(u(9)/2)) + f2*(sin(u(7)/2) + sin(u(9)/2)))*(2*cos(u(3) + u(5) + u(7)) + 2*cos(u(5) + u(7)) + 2*cos(u(7)) + 1) - l*(2*f1*(cos(u(9)/2) - cos(u(11)/2)) + 2*f2*(cos(u(9)/2) - cos(u(11)/2)))*(sin(u(5) + u(7) + u(9)) + sin(u(3) + u(5) + u(7) + u(9)) + sin(u(7) + u(9)) + sin(u(9))) + l*(f1*(sin(u(13)/2) + sin(u(15)/2)) + f2*(sin(u(13)/2) + sin(u(15)/2)))*(2*cos(u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(9) + u(11) + u(13)) + 2*cos(u(3) + u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(7) + u(9) + u(11) + u(13)) + 2*cos(u(11) + u(13)) + 2*cos(u(13)) + 1) + l*(f1*sin(u(15)/2) + f2*sin(u(15)/2))*(2*cos(u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(11) + u(13) + u(15)) + 2*cos(u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(9) + u(11) + u(13) + u(15)) + 2*cos(u(13) + u(15)) + 2*cos(u(15)) + 2*cos(u(3) + u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 1) - l*sin(u(3))*(2*f1*(cos(u(3)/2) - cos(u(5)/2)) + 2*f2*(cos(u(3)/2) - cos(u(5)/2))) - l*sin(u(3))*(2*ff1*(cos(u(3)/2) - cos(u(5)/2)) + 2*ff2*(cos(u(3)/2) - cos(u(5)/2)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        r*(f1*(cos(u(3)/2) - cos(u(5)/2)) - f2*(cos(u(3)/2) - cos(u(5)/2))) + r*(f1*(cos(u(5)/2) - cos(u(7)/2)) - f2*(cos(u(5)/2) - cos(u(7)/2))) + r*(f1*(cos(u(7)/2) - cos(u(9)/2)) - f2*(cos(u(7)/2) - cos(u(9)/2))) + r*(f1*(cos(u(9)/2) - cos(u(11)/2)) - f2*(cos(u(9)/2) - cos(u(11)/2))) + r*(f1*(cos(u(11)/2) - cos(u(13)/2)) - f2*(cos(u(11)/2) - cos(u(13)/2))) + r*(f1*(cos(u(13)/2) - cos(u(15)/2)) - f2*(cos(u(13)/2) - cos(u(15)/2))) + r2*(ff1*(cos(u(3)/2) - cos(u(5)/2)) - ff2*(cos(u(3)/2) - cos(u(5)/2))) + r2*(ff1*(cos(u(5)/2) - cos(u(7)/2)) - ff2*(cos(u(5)/2) - cos(u(7)/2))) + r*(f1*cos(u(15)/2) - f2*cos(u(15)/2)) + r2*(ff1*cos(u(7)/2) - ff2*cos(u(7)/2)) + l*(f1*(sin(u(3)/2) + sin(u(5)/2)) + f2*(sin(u(3)/2) + sin(u(5)/2))) + l*(ff1*(sin(u(3)/2) + sin(u(5)/2)) + ff2*(sin(u(3)/2) + sin(u(5)/2))) - l*(2*f1*(cos(u(13)/2) - cos(u(15)/2)) + 2*f2*(cos(u(13)/2) - cos(u(15)/2)))*(sin(u(5) + u(7) + u(9) + u(11) + u(13)) + sin(u(9) + u(11) + u(13)) + sin(u(7) + u(9) + u(11) + u(13)) + sin(u(11) + u(13)) + sin(u(13))) + l*(f1*(sin(u(13)/2) + sin(u(15)/2)) + f2*(sin(u(13)/2) + sin(u(15)/2)))*(2*cos(u(5) + u(7) + u(9) + u(11) + u(13)) + 2*cos(u(9) + u(11) + u(13)) + 2*cos(u(7) + u(9) + u(11) + u(13)) + 2*cos(u(11) + u(13)) + 2*cos(u(13)) + 1) - l*(sin(u(5) + u(7)) + sin(u(7)))*(2*f1*(cos(u(7)/2) - cos(u(9)/2)) + 2*f2*(cos(u(7)/2) - cos(u(9)/2))) - l*(sin(u(5) + u(7)) + sin(u(7)))*(2*ff1*cos(u(7)/2) + 2*ff2*cos(u(7)/2)) + l*(2*cos(u(5)) + 1)*(f1*(sin(u(5)/2) + sin(u(7)/2)) + f2*(sin(u(5)/2) + sin(u(7)/2))) + l*(2*cos(u(5)) + 1)*(ff1*(sin(u(5)/2) + sin(u(7)/2)) + ff2*(sin(u(5)/2) + sin(u(7)/2))) + l*(f1*(sin(u(7)/2) + sin(u(9)/2)) + f2*(sin(u(7)/2) + sin(u(9)/2)))*(2*cos(u(5) + u(7)) + 2*cos(u(7)) + 1) - l*(2*f1*(cos(u(9)/2) - cos(u(11)/2)) + 2*f2*(cos(u(9)/2) - cos(u(11)/2)))*(sin(u(5) + u(7) + u(9)) + sin(u(7) + u(9)) + sin(u(9))) + l*(f1*sin(u(15)/2) + f2*sin(u(15)/2))*(2*cos(u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(11) + u(13) + u(15)) + 2*cos(u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(9) + u(11) + u(13) + u(15)) + 2*cos(u(13) + u(15)) + 2*cos(u(15)) + 1) - l*(2*f1*cos(u(15)/2) + 2*f2*cos(u(15)/2))*(sin(u(7) + u(9) + u(11) + u(13) + u(15)) + sin(u(11) + u(13) + u(15)) + sin(u(5) + u(7) + u(9) + u(11) + u(13) + u(15)) + sin(u(9) + u(11) + u(13) + u(15)) + sin(u(13) + u(15)) + sin(u(15))) + l*(f1*(sin(u(11)/2) + sin(u(13)/2)) + f2*(sin(u(11)/2) + sin(u(13)/2)))*(2*cos(u(7) + u(9) + u(11)) + 2*cos(u(5) + u(7) + u(9) + u(11)) + 2*cos(u(9) + u(11)) + 2*cos(u(11)) + 1) + l*(ff1*sin(u(7)/2) - f3 + ff2*sin(u(7)/2))*(2*cos(u(5) + u(7)) + 2*cos(u(7)) + 1) + l*(f1*(sin(u(9)/2) + sin(u(11)/2)) + f2*(sin(u(9)/2) + sin(u(11)/2)))*(2*cos(u(5) + u(7) + u(9)) + 2*cos(u(7) + u(9)) + 2*cos(u(9)) + 1) - l*(2*f1*(cos(u(11)/2) - cos(u(13)/2)) + 2*f2*(cos(u(11)/2) - cos(u(13)/2)))*(sin(u(7) + u(9) + u(11)) + sin(u(5) + u(7) + u(9) + u(11)) + sin(u(9) + u(11)) + sin(u(11))) - l*sin(u(5))*(2*f1*(cos(u(5)/2) - cos(u(7)/2)) + 2*f2*(cos(u(5)/2) - cos(u(7)/2))) - l*sin(u(5))*(2*ff1*(cos(u(5)/2) - cos(u(7)/2)) + 2*ff2*(cos(u(5)/2) - cos(u(7)/2)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   r*(f1*(cos(u(5)/2) - cos(u(7)/2)) - f2*(cos(u(5)/2) - cos(u(7)/2))) + r*(f1*(cos(u(7)/2) - cos(u(9)/2)) - f2*(cos(u(7)/2) - cos(u(9)/2))) + r*(f1*(cos(u(9)/2) - cos(u(11)/2)) - f2*(cos(u(9)/2) - cos(u(11)/2))) + r*(f1*(cos(u(11)/2) - cos(u(13)/2)) - f2*(cos(u(11)/2) - cos(u(13)/2))) + r*(f1*(cos(u(13)/2) - cos(u(15)/2)) - f2*(cos(u(13)/2) - cos(u(15)/2))) + r2*(ff1*(cos(u(5)/2) - cos(u(7)/2)) - ff2*(cos(u(5)/2) - cos(u(7)/2))) + r*(f1*cos(u(15)/2) - f2*cos(u(15)/2)) + r2*(ff1*cos(u(7)/2) - ff2*cos(u(7)/2)) + l*(f1*(sin(u(5)/2) + sin(u(7)/2)) + f2*(sin(u(5)/2) + sin(u(7)/2))) + l*(ff1*(sin(u(5)/2) + sin(u(7)/2)) + ff2*(sin(u(5)/2) + sin(u(7)/2))) - l*sin(u(7))*(2*ff1*cos(u(7)/2) + 2*ff2*cos(u(7)/2)) - l*(sin(u(7) + u(9)) + sin(u(9)))*(2*f1*(cos(u(9)/2) - cos(u(11)/2)) + 2*f2*(cos(u(9)/2) - cos(u(11)/2))) - l*(2*f1*cos(u(15)/2) + 2*f2*cos(u(15)/2))*(sin(u(7) + u(9) + u(11) + u(13) + u(15)) + sin(u(11) + u(13) + u(15)) + sin(u(9) + u(11) + u(13) + u(15)) + sin(u(13) + u(15)) + sin(u(15))) + l*(2*cos(u(7)) + 1)*(f1*(sin(u(7)/2) + sin(u(9)/2)) + f2*(sin(u(7)/2) + sin(u(9)/2))) + l*(f1*(sin(u(9)/2) + sin(u(11)/2)) + f2*(sin(u(9)/2) + sin(u(11)/2)))*(2*cos(u(7) + u(9)) + 2*cos(u(9)) + 1) - l*(2*f1*(cos(u(11)/2) - cos(u(13)/2)) + 2*f2*(cos(u(11)/2) - cos(u(13)/2)))*(sin(u(7) + u(9) + u(11)) + sin(u(9) + u(11)) + sin(u(11))) + l*(2*cos(u(7)) + 1)*(ff1*sin(u(7)/2) - f3 + ff2*sin(u(7)/2)) + l*(f1*(sin(u(13)/2) + sin(u(15)/2)) + f2*(sin(u(13)/2) + sin(u(15)/2)))*(2*cos(u(9) + u(11) + u(13)) + 2*cos(u(7) + u(9) + u(11) + u(13)) + 2*cos(u(11) + u(13)) + 2*cos(u(13)) + 1) + l*(f1*(sin(u(11)/2) + sin(u(13)/2)) + f2*(sin(u(11)/2) + sin(u(13)/2)))*(2*cos(u(7) + u(9) + u(11)) + 2*cos(u(9) + u(11)) + 2*cos(u(11)) + 1) + l*(f1*sin(u(15)/2) + f2*sin(u(15)/2))*(2*cos(u(7) + u(9) + u(11) + u(13) + u(15)) + 2*cos(u(11) + u(13) + u(15)) + 2*cos(u(9) + u(11) + u(13) + u(15)) + 2*cos(u(13) + u(15)) + 2*cos(u(15)) + 1) - l*(2*f1*(cos(u(13)/2) - cos(u(15)/2)) + 2*f2*(cos(u(13)/2) - cos(u(15)/2)))*(sin(u(9) + u(11) + u(13)) + sin(u(7) + u(9) + u(11) + u(13)) + sin(u(11) + u(13)) + sin(u(13))) - l*sin(u(7))*(2*f1*(cos(u(7)/2) - cos(u(9)/2)) + 2*f2*(cos(u(7)/2) - cos(u(9)/2)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                l*(ff1*sin(u(7)/2) - f3 + ff2*sin(u(7)/2)) + r*(f1*(cos(u(7)/2) - cos(u(9)/2)) - f2*(cos(u(7)/2) - cos(u(9)/2))) + r*(f1*(cos(u(9)/2) - cos(u(11)/2)) - f2*(cos(u(9)/2) - cos(u(11)/2))) + r*(f1*(cos(u(11)/2) - cos(u(13)/2)) - f2*(cos(u(11)/2) - cos(u(13)/2))) + r*(f1*(cos(u(13)/2) - cos(u(15)/2)) - f2*(cos(u(13)/2) - cos(u(15)/2))) + r*(f1*cos(u(15)/2) - f2*cos(u(15)/2)) + r2*(ff1*cos(u(7)/2) - ff2*cos(u(7)/2)) + l*(f1*(sin(u(7)/2) + sin(u(9)/2)) + f2*(sin(u(7)/2) + sin(u(9)/2))) - l*(sin(u(9) + u(11)) + sin(u(11)))*(2*f1*(cos(u(11)/2) - cos(u(13)/2)) + 2*f2*(cos(u(11)/2) - cos(u(13)/2))) + l*(2*cos(u(9)) + 1)*(f1*(sin(u(9)/2) + sin(u(11)/2)) + f2*(sin(u(9)/2) + sin(u(11)/2))) + l*(f1*(sin(u(11)/2) + sin(u(13)/2)) + f2*(sin(u(11)/2) + sin(u(13)/2)))*(2*cos(u(9) + u(11)) + 2*cos(u(11)) + 1) - l*(2*f1*(cos(u(13)/2) - cos(u(15)/2)) + 2*f2*(cos(u(13)/2) - cos(u(15)/2)))*(sin(u(9) + u(11) + u(13)) + sin(u(11) + u(13)) + sin(u(13))) + l*(f1*sin(u(15)/2) + f2*sin(u(15)/2))*(2*cos(u(11) + u(13) + u(15)) + 2*cos(u(9) + u(11) + u(13) + u(15)) + 2*cos(u(13) + u(15)) + 2*cos(u(15)) + 1) + l*(f1*(sin(u(13)/2) + sin(u(15)/2)) + f2*(sin(u(13)/2) + sin(u(15)/2)))*(2*cos(u(9) + u(11) + u(13)) + 2*cos(u(11) + u(13)) + 2*cos(u(13)) + 1) - l*sin(u(9))*(2*f1*(cos(u(9)/2) - cos(u(11)/2)) + 2*f2*(cos(u(9)/2) - cos(u(11)/2))) - l*(2*f1*cos(u(15)/2) + 2*f2*cos(u(15)/2))*(sin(u(11) + u(13) + u(15)) + sin(u(9) + u(11) + u(13) + u(15)) + sin(u(13) + u(15)) + sin(u(15)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    r*(f1*(cos(u(9)/2) - cos(u(11)/2)) - f2*(cos(u(9)/2) - cos(u(11)/2))) + r*(f1*(cos(u(11)/2) - cos(u(13)/2)) - f2*(cos(u(11)/2) - cos(u(13)/2))) + r*(f1*(cos(u(13)/2) - cos(u(15)/2)) - f2*(cos(u(13)/2) - cos(u(15)/2))) + r*(f1*cos(u(15)/2) - f2*cos(u(15)/2)) + l*(f1*(sin(u(9)/2) + sin(u(11)/2)) + f2*(sin(u(9)/2) + sin(u(11)/2))) - l*(sin(u(11) + u(13)) + sin(u(13)))*(2*f1*(cos(u(13)/2) - cos(u(15)/2)) + 2*f2*(cos(u(13)/2) - cos(u(15)/2))) + l*(2*cos(u(11)) + 1)*(f1*(sin(u(11)/2) + sin(u(13)/2)) + f2*(sin(u(11)/2) + sin(u(13)/2))) + l*(f1*(sin(u(13)/2) + sin(u(15)/2)) + f2*(sin(u(13)/2) + sin(u(15)/2)))*(2*cos(u(11) + u(13)) + 2*cos(u(13)) + 1) - l*(2*f1*cos(u(15)/2) + 2*f2*cos(u(15)/2))*(sin(u(11) + u(13) + u(15)) + sin(u(13) + u(15)) + sin(u(15))) + l*(f1*sin(u(15)/2) + f2*sin(u(15)/2))*(2*cos(u(11) + u(13) + u(15)) + 2*cos(u(13) + u(15)) + 2*cos(u(15)) + 1) - l*sin(u(11))*(2*f1*(cos(u(11)/2) - cos(u(13)/2)) + 2*f2*(cos(u(11)/2) - cos(u(13)/2)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      r*(f1*(cos(u(11)/2) - cos(u(13)/2)) - f2*(cos(u(11)/2) - cos(u(13)/2))) + r*(f1*(cos(u(13)/2) - cos(u(15)/2)) - f2*(cos(u(13)/2) - cos(u(15)/2))) + r*(f1*cos(u(15)/2) - f2*cos(u(15)/2)) + l*(f1*(sin(u(11)/2) + sin(u(13)/2)) + f2*(sin(u(11)/2) + sin(u(13)/2))) - l*(sin(u(13) + u(15)) + sin(u(15)))*(2*f1*cos(u(15)/2) + 2*f2*cos(u(15)/2)) + l*(2*cos(u(13)) + 1)*(f1*(sin(u(13)/2) + sin(u(15)/2)) + f2*(sin(u(13)/2) + sin(u(15)/2))) + l*(f1*sin(u(15)/2) + f2*sin(u(15)/2))*(2*cos(u(13) + u(15)) + 2*cos(u(15)) + 1) - l*sin(u(13))*(2*f1*(cos(u(13)/2) - cos(u(15)/2)) + 2*f2*(cos(u(13)/2) - cos(u(15)/2)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      r*(f1*(cos(u(13)/2) - cos(u(15)/2)) - f2*(cos(u(13)/2) - cos(u(15)/2))) + r*(f1*cos(u(15)/2) - f2*cos(u(15)/2)) + l*(f1*(sin(u(13)/2) + sin(u(15)/2)) + f2*(sin(u(13)/2) + sin(u(15)/2))) - l*sin(u(15))*(2*f1*cos(u(15)/2) + 2*f2*cos(u(15)/2)) + l*(f1*sin(u(15)/2) + f2*sin(u(15)/2))*(2*cos(u(15)) + 1)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                r*(f1*cos(u(15)/2) - f2*cos(u(15)/2)) + l*(f1*sin(u(15)/2) + f2*sin(u(15)/2))];
 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    dot_theta = @(u) [u(2);
        u(4);
        u(6);
        u(8);
        u(10);
        u(12);
        u(14);
        u(16)]; 


    
    state = @(u) M(u)\(-C(u)*dot_theta(u) - G(u) + Q(u));

    dudt=[u(2);...
        subsref(state(u), struct('type', '()', 'subs', {{1}}));...
        u(4);...
        subsref(state(u), struct('type', '()', 'subs', {{2}}));...
        u(6);...
        subsref(state(u), struct('type', '()', 'subs', {{3}}));...
        u(8);...
        subsref(state(u), struct('type', '()', 'subs', {{4}}));...
        u(10);...
        subsref(state(u), struct('type', '()', 'subs', {{5}}));...
        u(12);...
        subsref(state(u), struct('type', '()', 'subs', {{6}}));...
        u(14);...
        subsref(state(u), struct('type', '()', 'subs', {{7}}));...  
        u(16);...
        subsref(state(u), struct('type', '()', 'subs', {{8}}));...
        - (t_actual-t_target);...
        - (r_actual-r_target);...
    ];

    u_prev = u;
end

function update_targett(slider_t, EventData)
global t_target
    t_target = slider_t.Value;
end

function update_targetr(slider_r, EventData)
global r_target
    r_target = slider_r.Value;
end